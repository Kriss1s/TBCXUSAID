export default class Questions {
  constructor(element, url, questionsNumber) {
    this.faqContainer = document.querySelector(element);
    this.faqData = [];
    this.faqQuestions = [];
    this.url = url;
    this.questionsNumber = questionsNumber;
  }

  async init() {
    await this.getQuestions();
    this.render();
    this.faqQuestions.forEach(question => this.toggleAnswer(question));
  }

  async getQuestions() {
    try {
      const response = await fetch(this.url);
      const data = await response.json();
      this.faqData = [...data.questions];
    } catch (err) {
      console.log(err.message);
    }
  }

  render() {
    let count = 0;
    this.faqData.forEach(faqItem => {
      if (count >= this.questionsNumber) {
        return;
      }
      this.createFAQQuestion(faqItem);
      count++;
    });
    this.faqQuestions = document.querySelectorAll('.faq-question');
  }

  createFAQQuestion(faqItem) {
    // console.log(faqItem);
    const questionHTML = `
                        <div class="faq-question-wrapper">
                            <div class="faq-question">
                                <h6>${faqItem.question}</h6>
                                <span class="icon"></span>
                            </div>
                            <p class="faq-answer hidden">
                            ${faqItem.answer}
                            </p>
                        </div>`;
    this.faqContainer.insertAdjacentHTML('beforeend', questionHTML);
  }

  toggleAnswer(question) {
    question.addEventListener('click', () => {
      this.faqQuestions.forEach(faqQuestion => {
        console.log(faqQuestion !== question);
        if (faqQuestion !== question) {
          if (faqQuestion.classList.contains('reversed')) {
            faqQuestion.classList.remove('reversed');
          }
          if (!faqQuestion.nextElementSibling.classList.contains('hidden')) {
            faqQuestion.nextElementSibling.classList.add('hidden');
          }
        }
      });
      question.classList.toggle('reversed');
      question.nextElementSibling.classList.toggle('hidden');
    });
  }
}
